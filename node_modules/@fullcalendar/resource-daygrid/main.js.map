{"version":3,"file":"main.js","sources":["src/ResourceDayTableJoiner.ts","src/ResourceDayTable.tsx","src/ResourceDayTableView.tsx","src/main.ts"],"sourcesContent":["import { TableSeg } from '@fullcalendar/daygrid'\nimport { AbstractResourceDayTableModel, VResourceJoiner } from '@fullcalendar/resource-common'\n\nexport class ResourceDayTableJoiner extends VResourceJoiner<TableSeg> {\n  transformSeg(seg: TableSeg, resourceDayTableModel: AbstractResourceDayTableModel, resourceI: number): TableSeg[] {\n    let colRanges = resourceDayTableModel.computeColRanges(seg.firstCol, seg.lastCol, resourceI)\n\n    return colRanges.map((colRange) => ({\n      ...seg,\n      ...colRange,\n      isStart: seg.isStart && colRange.isStart,\n      isEnd: seg.isEnd && colRange.isEnd,\n    }))\n  }\n}\n","import {\n  createElement, createRef, VNode,\n  mapHash, Hit, DateSpan, DateComponent, EventStore, EventUiHash, EventInteractionState, Duration, RefObject, CssDimValue, DateProfile,\n} from '@fullcalendar/common'\nimport { DayTableSlicer, Table } from '@fullcalendar/daygrid'\nimport { AbstractResourceDayTableModel, VResourceSplitter } from '@fullcalendar/resource-common'\nimport { ResourceDayTableJoiner } from './ResourceDayTableJoiner'\n\nexport interface ResourceDayTableProps {\n  dateProfile: DateProfile\n  resourceDayTableModel: AbstractResourceDayTableModel\n  businessHours: EventStore\n  eventStore: EventStore\n  eventUiBases: EventUiHash\n  dateSelection: DateSpan | null\n  eventSelection: string\n  eventDrag: EventInteractionState | null\n  eventResize: EventInteractionState | null\n  nextDayThreshold: Duration\n  tableMinWidth: CssDimValue\n  colGroupNode: VNode\n  renderRowIntro?: () => VNode\n  dayMaxEvents: boolean | number\n  dayMaxEventRows: boolean | number\n  expandRows: boolean\n  showWeekNumbers: boolean\n  headerAlignElRef?: RefObject<HTMLElement> // for more popover alignment\n  clientWidth: number | null\n  clientHeight: number | null\n  forPrint: boolean\n}\n\nexport class ResourceDayTable extends DateComponent<ResourceDayTableProps> {\n  private splitter = new VResourceSplitter()\n  private slicers: { [resourceId: string]: DayTableSlicer } = {}\n  private joiner = new ResourceDayTableJoiner()\n  private tableRef = createRef<Table>()\n\n  render() {\n    let { props, context } = this\n    let { resourceDayTableModel, nextDayThreshold, dateProfile } = props\n\n    let splitProps = this.splitter.splitProps(props)\n    this.slicers = mapHash(splitProps, (split, resourceId) => this.slicers[resourceId] || new DayTableSlicer())\n    let slicedProps = mapHash(this.slicers, (slicer, resourceId) => slicer.sliceProps(\n      splitProps[resourceId],\n      dateProfile,\n      nextDayThreshold,\n      context,\n      resourceDayTableModel.dayTableModel,\n    ))\n\n    return (\n      <Table\n        forPrint={props.forPrint}\n        ref={this.tableRef}\n        {...this.joiner.joinProps(slicedProps, resourceDayTableModel)}\n        cells={resourceDayTableModel.cells}\n        dateProfile={dateProfile}\n        colGroupNode={props.colGroupNode}\n        tableMinWidth={props.tableMinWidth}\n        renderRowIntro={props.renderRowIntro}\n        dayMaxEvents={props.dayMaxEvents}\n        dayMaxEventRows={props.dayMaxEventRows}\n        showWeekNumbers={props.showWeekNumbers}\n        expandRows={props.expandRows}\n        headerAlignElRef={props.headerAlignElRef}\n        clientWidth={props.clientWidth}\n        clientHeight={props.clientHeight}\n        isHitComboAllowed={this.isHitComboAllowed}\n      />\n    )\n  }\n\n  isHitComboAllowed = (hit0: Hit, hit1: Hit) => {\n    let allowAcrossResources = this.props.resourceDayTableModel.dayTableModel.colCnt === 1\n    return allowAcrossResources || hit0.dateSpan.resourceId === hit1.dateSpan.resourceId\n  }\n}\n","import {\n  createElement,\n  createRef,\n  DateProfileGenerator,\n  memoize,\n  DateProfile,\n  ChunkContentCallbackArgs,\n  CalendarContext,\n} from '@fullcalendar/common'\nimport { TableView, buildDayTableModel } from '@fullcalendar/daygrid'\nimport {\n  ResourceDayHeader, ResourceDayTableModel, DayResourceTableModel, ResourceViewProps,\n  Resource, flattenResources, DEFAULT_RESOURCE_ORDER,\n} from '@fullcalendar/resource-common'\nimport { ResourceDayTable } from './ResourceDayTable'\n\nexport class ResourceDayTableView extends TableView {\n  props: ResourceViewProps\n\n  private flattenResources = memoize(flattenResources)\n  private buildResourceDayTableModel = memoize(buildResourceDayTableModel)\n  private headerRef = createRef<ResourceDayHeader>()\n  private tableRef = createRef<ResourceDayTable>()\n\n  render() {\n    let { props, context } = this\n    let { options } = context\n\n    let resourceOrderSpecs = options.resourceOrder || DEFAULT_RESOURCE_ORDER\n    let resources = this.flattenResources(props.resourceStore, resourceOrderSpecs)\n    let resourceDayTableModel = this.buildResourceDayTableModel(\n      props.dateProfile,\n      context.dateProfileGenerator,\n      resources,\n      options.datesAboveResources,\n      context,\n    )\n\n    let headerContent = options.dayHeaders && (\n      <ResourceDayHeader\n        ref={this.headerRef}\n        resources={resources}\n        dateProfile={props.dateProfile}\n        dates={resourceDayTableModel.dayTableModel.headerDates}\n        datesRepDistinctDays\n      />\n    )\n\n    let bodyContent = (contentArg: ChunkContentCallbackArgs) => (\n      <ResourceDayTable\n        ref={this.tableRef}\n        dateProfile={props.dateProfile}\n        resourceDayTableModel={resourceDayTableModel}\n        businessHours={props.businessHours}\n        eventStore={props.eventStore}\n        eventUiBases={props.eventUiBases}\n        dateSelection={props.dateSelection}\n        eventSelection={props.eventSelection}\n        eventDrag={props.eventDrag}\n        eventResize={props.eventResize}\n        nextDayThreshold={options.nextDayThreshold}\n        tableMinWidth={contentArg.tableMinWidth}\n        colGroupNode={contentArg.tableColGroupNode}\n        dayMaxEvents={options.dayMaxEvents}\n        dayMaxEventRows={options.dayMaxEventRows}\n        showWeekNumbers={options.weekNumbers}\n        expandRows={!props.isHeightAuto}\n        headerAlignElRef={this.headerElRef}\n        clientWidth={contentArg.clientWidth}\n        clientHeight={contentArg.clientHeight}\n        forPrint={props.forPrint}\n      />\n    )\n\n    return options.dayMinWidth\n      ? this.renderHScrollLayout(headerContent, bodyContent, resourceDayTableModel.colCnt, options.dayMinWidth)\n      : this.renderSimpleLayout(headerContent, bodyContent)\n  }\n}\n\nfunction buildResourceDayTableModel(\n  dateProfile: DateProfile,\n  dateProfileGenerator: DateProfileGenerator,\n  resources: Resource[],\n  datesAboveResources: boolean,\n  context: CalendarContext,\n) {\n  let dayTable = buildDayTableModel(dateProfile, dateProfileGenerator)\n\n  return datesAboveResources ?\n    new DayResourceTableModel(dayTable, resources, context) :\n    new ResourceDayTableModel(dayTable, resources, context)\n}\n","import { createPlugin } from '@fullcalendar/common'\n\nimport premiumCommonPlugin from '@fullcalendar/premium-common' // eslint-disable-line import/no-duplicates\n// ensure ambient declarations\nimport '@fullcalendar/premium-common' // eslint-disable-line import/no-duplicates\n\nimport resourceCommonPlugin from '@fullcalendar/resource-common'\nimport dayGridPlugin from '@fullcalendar/daygrid'\nimport { ResourceDayTableView } from './ResourceDayTableView'\n\nexport { ResourceDayTableView }\nexport { ResourceDayTable } from './ResourceDayTable'\n\nexport default createPlugin({\n  deps: [\n    premiumCommonPlugin,\n    resourceCommonPlugin,\n    dayGridPlugin,\n  ],\n  initialView: 'resourceDayGridDay',\n  views: {\n\n    resourceDayGrid: {\n      type: 'dayGrid', // will inherit this configuration\n      component: ResourceDayTableView,\n      needsResourceData: true,\n    },\n\n    resourceDayGridDay: {\n      type: 'resourceDayGrid',\n      duration: { days: 1 },\n    },\n\n    resourceDayGridWeek: {\n      type: 'resourceDayGrid',\n      duration: { weeks: 1 },\n    },\n\n    resourceDayGridMonth: {\n      type: 'resourceDayGrid',\n      duration: { months: 1 },\n\n      // TODO: wish we didn't have to C&P from dayGrid's file\n      monthMode: true, // a hidden option!?\n      fixedWeekCount: true,\n    },\n\n  },\n})\n"],"names":[],"mappings":"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"}