{"version":3,"file":"main.js","sources":["src/ResourceDayTimeColsJoiner.ts","src/ResourceDayTimeCols.tsx","src/ResourceDayTimeColsView.tsx","src/main.ts"],"sourcesContent":["import { TimeColsSeg } from '@fullcalendar/timegrid'\nimport { AbstractResourceDayTableModel, VResourceJoiner } from '@fullcalendar/resource-common'\n\nexport class ResourceDayTimeColsJoiner extends VResourceJoiner<TimeColsSeg> {\n  transformSeg(seg: TimeColsSeg, resourceDayTable: AbstractResourceDayTableModel, resourceI: number) {\n    return [\n      {\n        ...seg,\n        col: resourceDayTable.computeCol(seg.col, resourceI),\n      },\n    ]\n  }\n}\n","import {\n  createElement, createRef, VNode,\n  mapHash, DateSpan, DateComponent, EventStore, EventUiHash, EventInteractionState, memoize, DateRange,\n  DateMarker, Hit, CssDimValue, NowTimer, Duration, DateProfile,\n} from '@fullcalendar/common'\nimport { DayTimeColsSlicer, TimeCols, buildDayRanges, TimeSlatMeta, TimeColsSlatsCoords } from '@fullcalendar/timegrid'\nimport { AbstractResourceDayTableModel, VResourceSplitter } from '@fullcalendar/resource-common'\nimport { ResourceDayTimeColsJoiner } from './ResourceDayTimeColsJoiner'\n\nexport interface ResourceDayTimeColsProps {\n  dateProfile: DateProfile\n  resourceDayTableModel: AbstractResourceDayTableModel\n  axis: boolean\n  slotDuration: Duration\n  slatMetas: TimeSlatMeta[]\n  businessHours: EventStore\n  eventStore: EventStore\n  eventUiBases: EventUiHash\n  dateSelection: DateSpan | null\n  eventSelection: string\n  eventDrag: EventInteractionState | null\n  eventResize: EventInteractionState | null\n  tableColGroupNode: VNode\n  tableMinWidth: CssDimValue\n  clientWidth: number | null\n  clientHeight: number | null\n  expandRows: boolean\n  onScrollTopRequest?: (scrollTop: number) => void\n  forPrint: boolean\n  onSlatCoords?: (slatCoords: TimeColsSlatsCoords) => void\n}\n\nexport class ResourceDayTimeCols extends DateComponent<ResourceDayTimeColsProps> {\n  private buildDayRanges = memoize(buildDayRanges)\n  private dayRanges: DateRange[] // for now indicator\n  private splitter = new VResourceSplitter()\n  private slicers: { [resourceId: string]: DayTimeColsSlicer } = {}\n  private joiner = new ResourceDayTimeColsJoiner()\n  private timeColsRef = createRef<TimeCols>()\n\n  render() {\n    let { props, context } = this\n    let { dateEnv, options } = context\n    let { dateProfile, resourceDayTableModel } = props\n\n    let dayRanges = this.dayRanges = this.buildDayRanges(resourceDayTableModel.dayTableModel, dateProfile, dateEnv)\n    let splitProps = this.splitter.splitProps(props)\n\n    this.slicers = mapHash(splitProps, (split, resourceId) => this.slicers[resourceId] || new DayTimeColsSlicer())\n    let slicedProps = mapHash(this.slicers, (slicer, resourceId) => slicer.sliceProps(\n      splitProps[resourceId],\n      dateProfile,\n      null,\n      context,\n      dayRanges,\n    ))\n\n    return ( // TODO: would move this further down hierarchy, but sliceNowDate needs it\n      <NowTimer unit={options.nowIndicator ? 'minute' : 'day'}>\n        {(nowDate: DateMarker, todayRange: DateRange) => (\n          <TimeCols\n            ref={this.timeColsRef}\n            {...this.joiner.joinProps(slicedProps, resourceDayTableModel)}\n            dateProfile={dateProfile}\n            axis={props.axis}\n            slotDuration={props.slotDuration}\n            slatMetas={props.slatMetas}\n            cells={resourceDayTableModel.cells[0]}\n            tableColGroupNode={props.tableColGroupNode}\n            tableMinWidth={props.tableMinWidth}\n            clientWidth={props.clientWidth}\n            clientHeight={props.clientHeight}\n            expandRows={props.expandRows}\n            nowDate={nowDate}\n            nowIndicatorSegs={options.nowIndicator && this.buildNowIndicatorSegs(nowDate)}\n            todayRange={todayRange}\n            onScrollTopRequest={props.onScrollTopRequest}\n            forPrint={props.forPrint}\n            onSlatCoords={props.onSlatCoords}\n            isHitComboAllowed={this.isHitComboAllowed}\n          />\n        )}\n      </NowTimer>\n    )\n  }\n\n  isHitComboAllowed = (hit0: Hit, hit1: Hit) => {\n    let allowAcrossResources = this.dayRanges.length === 1\n    return allowAcrossResources || hit0.dateSpan.resourceId === hit1.dateSpan.resourceId\n  }\n\n  buildNowIndicatorSegs(date: DateMarker) {\n    let nonResourceSegs = this.slicers[''].sliceNowDate(date, this.context, this.dayRanges)\n    return this.joiner.expandSegs(this.props.resourceDayTableModel, nonResourceSegs)\n  }\n}\n","import { createElement, DateProfileGenerator, memoize, DateProfile, ChunkContentCallbackArgs, CalendarContext } from '@fullcalendar/common'\nimport { TimeColsView, buildTimeColsModel, buildSlatMetas } from '@fullcalendar/timegrid'\nimport {\n  ResourceDayHeader, ResourceDayTableModel, DayResourceTableModel, ResourceViewProps,\n  Resource, flattenResources, DEFAULT_RESOURCE_ORDER,\n} from '@fullcalendar/resource-common'\nimport { ResourceDayTable } from '@fullcalendar/resource-daygrid'\nimport { ResourceDayTimeCols } from './ResourceDayTimeCols'\n\nexport class ResourceDayTimeColsView extends TimeColsView {\n  props: ResourceViewProps\n\n  private flattenResources = memoize(flattenResources)\n  private buildResourceTimeColsModel = memoize(buildResourceTimeColsModel)\n  private buildSlatMetas = memoize(buildSlatMetas)\n\n  render() {\n    let { props, context } = this\n    let { options, dateEnv } = context\n    let { dateProfile } = props\n\n    let splitProps = this.allDaySplitter.splitProps(props)\n    let resourceOrderSpecs = options.resourceOrder || DEFAULT_RESOURCE_ORDER\n    let resources = this.flattenResources(props.resourceStore, resourceOrderSpecs)\n    let resourceDayTableModel = this.buildResourceTimeColsModel(\n      dateProfile,\n      context.dateProfileGenerator,\n      resources,\n      options.datesAboveResources,\n      context,\n    )\n\n    let slatMetas = this.buildSlatMetas(\n      dateProfile.slotMinTime,\n      dateProfile.slotMaxTime,\n      options.slotLabelInterval,\n      options.slotDuration,\n      dateEnv,\n    )\n    let { dayMinWidth } = options\n    let hasAttachedAxis = !dayMinWidth\n    let hasDetachedAxis = dayMinWidth\n\n    let headerContent = options.dayHeaders && (\n      <ResourceDayHeader\n        resources={resources}\n        dates={resourceDayTableModel.dayTableModel.headerDates}\n        dateProfile={dateProfile}\n        datesRepDistinctDays\n        renderIntro={hasAttachedAxis ? this.renderHeadAxis : null}\n      />\n    )\n\n    let allDayContent = (options.allDaySlot !== false) && ((contentArg: ChunkContentCallbackArgs) => (\n      <ResourceDayTable\n        {...splitProps.allDay}\n        dateProfile={dateProfile}\n        resourceDayTableModel={resourceDayTableModel}\n        nextDayThreshold={options.nextDayThreshold}\n        tableMinWidth={contentArg.tableMinWidth}\n        colGroupNode={contentArg.tableColGroupNode}\n        renderRowIntro={hasAttachedAxis ? this.renderTableRowAxis : null}\n        showWeekNumbers={false}\n        expandRows={false}\n        headerAlignElRef={this.headerElRef}\n        clientWidth={contentArg.clientWidth}\n        clientHeight={contentArg.clientHeight}\n        forPrint={props.forPrint}\n        {...this.getAllDayMaxEventProps()}\n      />\n    ))\n\n    let timeGridContent = (contentArg: ChunkContentCallbackArgs) => (\n      <ResourceDayTimeCols\n        {...splitProps.timed}\n        dateProfile={dateProfile}\n        axis={hasAttachedAxis}\n        slotDuration={options.slotDuration}\n        slatMetas={slatMetas}\n        resourceDayTableModel={resourceDayTableModel}\n        tableColGroupNode={contentArg.tableColGroupNode}\n        tableMinWidth={contentArg.tableMinWidth}\n        clientWidth={contentArg.clientWidth}\n        clientHeight={contentArg.clientHeight}\n        onSlatCoords={this.handleSlatCoords}\n        expandRows={contentArg.expandRows}\n        forPrint={props.forPrint}\n        onScrollTopRequest={this.handleScrollTopRequest}\n      />\n    )\n\n    return hasDetachedAxis\n      ? this.renderHScrollLayout(\n        headerContent,\n        allDayContent,\n        timeGridContent,\n        resourceDayTableModel.colCnt,\n        dayMinWidth,\n        slatMetas,\n        this.state.slatCoords,\n      )\n      : this.renderSimpleLayout(\n        headerContent,\n        allDayContent,\n        timeGridContent,\n      )\n  }\n}\n\nfunction buildResourceTimeColsModel(\n  dateProfile: DateProfile,\n  dateProfileGenerator: DateProfileGenerator,\n  resources: Resource[],\n  datesAboveResources: boolean,\n  context: CalendarContext,\n) {\n  let dayTable = buildTimeColsModel(dateProfile, dateProfileGenerator)\n\n  return datesAboveResources ?\n    new DayResourceTableModel(dayTable, resources, context) :\n    new ResourceDayTableModel(dayTable, resources, context)\n}\n","import { createPlugin } from '@fullcalendar/common'\n\nimport premiumCommonPlugin from '@fullcalendar/premium-common' // eslint-disable-line import/no-duplicates\n// ensure ambient declarations\nimport '@fullcalendar/premium-common' // eslint-disable-line import/no-duplicates\n\nimport resourceCommonPlugin from '@fullcalendar/resource-common'\nimport timeGridPlugin from '@fullcalendar/timegrid'\nimport { ResourceDayTimeColsView } from './ResourceDayTimeColsView'\n\nexport { ResourceDayTimeColsView }\nexport { ResourceDayTimeCols } from './ResourceDayTimeCols'\n\nexport default createPlugin({\n  deps: [\n    premiumCommonPlugin,\n    resourceCommonPlugin,\n    timeGridPlugin,\n  ],\n  initialView: 'resourceTimeGridDay',\n  views: {\n\n    resourceTimeGrid: {\n      type: 'timeGrid', // will inherit this configuration\n      component: ResourceDayTimeColsView,\n      needsResourceData: true,\n    },\n\n    resourceTimeGridDay: {\n      type: 'resourceTimeGrid',\n      duration: { days: 1 },\n    },\n\n    resourceTimeGridWeek: {\n      type: 'resourceTimeGrid',\n      duration: { weeks: 1 },\n    },\n\n  },\n})\n"],"names":[],"mappings":";;;;;;;;;;;;AAGA;IAA+C,6CAA4B;IAA3E;;KASC;IARC,gDAAY,GAAZ,UAAa,GAAgB,EAAE,gBAA+C,EAAE,SAAiB;QAC/F,OAAO;kCAEA,GAAG,KACN,GAAG,EAAE,gBAAgB,CAAC,UAAU,CAAC,GAAG,CAAC,GAAG,EAAE,SAAS,CAAC;SAEvD,CAAA;KACF;IACH,gCAAC;AAAD,CATA,CAA+C,eAAe;;;IC6BrB,uCAAuC;IAAhF;QAAA,qEA+DC;QA9DS,oBAAc,GAAG,OAAO,CAAC,cAAc,CAAC,CAAA;QAExC,cAAQ,GAAG,IAAI,iBAAiB,EAAE,CAAA;QAClC,aAAO,GAAgD,EAAE,CAAA;QACzD,YAAM,GAAG,IAAI,yBAAyB,EAAE,CAAA;QACxC,iBAAW,GAAG,SAAS,EAAY,CAAA;QAgD3C,uBAAiB,GAAG,UAAC,IAAS,EAAE,IAAS;YACvC,IAAI,oBAAoB,GAAG,KAAI,CAAC,SAAS,CAAC,MAAM,KAAK,CAAC,CAAA;YACtD,OAAO,oBAAoB,IAAI,IAAI,CAAC,QAAQ,CAAC,UAAU,KAAK,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAA;SACrF,CAAA;;KAMF;IAvDC,oCAAM,GAAN;QAAA,iBA4CC;QA3CK,IAAA,KAAqB,IAAI,EAAvB,KAAK,WAAA,EAAE,OAAO,aAAS,CAAA;QACvB,IAAA,OAAO,GAAc,OAAO,QAArB,EAAE,OAAO,GAAK,OAAO,QAAZ,CAAY;QAC5B,IAAA,WAAW,GAA4B,KAAK,YAAjC,EAAE,qBAAqB,GAAK,KAAK,sBAAV,CAAU;QAElD,IAAI,SAAS,GAAG,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,cAAc,CAAC,qBAAqB,CAAC,aAAa,EAAE,WAAW,EAAE,OAAO,CAAC,CAAA;QAC/G,IAAI,UAAU,GAAG,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,CAAA;QAEhD,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,UAAU,EAAE,UAAC,KAAK,EAAE,UAAU,IAAK,OAAA,KAAI,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,IAAI,iBAAiB,EAAE,GAAA,CAAC,CAAA;QAC9G,IAAI,WAAW,GAAG,OAAO,CAAC,IAAI,CAAC,OAAO,EAAE,UAAC,MAAM,EAAE,UAAU,IAAK,OAAA,MAAM,CAAC,UAAU,CAC/E,UAAU,CAAC,UAAU,CAAC,EACtB,WAAW,EACX,IAAI,EACJ,OAAO,EACP,SAAS,CACV,GAAA,CAAC,CAAA;QAEF;QACE,cAAC,QAAQ,IAAC,IAAI,EAAE,OAAO,CAAC,YAAY,GAAG,QAAQ,GAAG,KAAK,IACpD,UAAC,OAAmB,EAAE,UAAqB,IAAK,QAC/C,cAAC,QAAQ,aACP,GAAG,EAAE,KAAI,CAAC,WAAW,IACjB,KAAI,CAAC,MAAM,CAAC,SAAS,CAAC,WAAW,EAAE,qBAAqB,CAAC,IAC7D,WAAW,EAAE,WAAW,EACxB,IAAI,EAAE,KAAK,CAAC,IAAI,EAChB,YAAY,EAAE,KAAK,CAAC,YAAY,EAChC,SAAS,EAAE,KAAK,CAAC,SAAS,EAC1B,KAAK,EAAE,qBAAqB,CAAC,KAAK,CAAC,CAAC,CAAC,EACrC,iBAAiB,EAAE,KAAK,CAAC,iBAAiB,EAC1C,aAAa,EAAE,KAAK,CAAC,aAAa,EAClC,WAAW,EAAE,KAAK,CAAC,WAAW,EAC9B,YAAY,EAAE,KAAK,CAAC,YAAY,EAChC,UAAU,EAAE,KAAK,CAAC,UAAU,EAC5B,OAAO,EAAE,OAAO,EAChB,gBAAgB,EAAE,OAAO,CAAC,YAAY,IAAI,KAAI,CAAC,qBAAqB,CAAC,OAAO,CAAC,EAC7E,UAAU,EAAE,UAAU,EACtB,kBAAkB,EAAE,KAAK,CAAC,kBAAkB,EAC5C,QAAQ,EAAE,KAAK,CAAC,QAAQ,EACxB,YAAY,EAAE,KAAK,CAAC,YAAY,EAChC,iBAAiB,EAAE,KAAI,CAAC,iBAAiB,IACzC,IACH,CACQ,EACZ;KACF;IAOD,mDAAqB,GAArB,UAAsB,IAAgB;QACpC,IAAI,eAAe,GAAG,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,YAAY,CAAC,IAAI,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,SAAS,CAAC,CAAA;QACvF,OAAO,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,qBAAqB,EAAE,eAAe,CAAC,CAAA;KACjF;IACH,0BAAC;AAAD,CA/DA,CAAyC,aAAa;;;ICvBT,2CAAY;IAAzD;QAAA,qEAkGC;QA/FS,sBAAgB,GAAG,OAAO,CAAC,gBAAgB,CAAC,CAAA;QAC5C,gCAA0B,GAAG,OAAO,CAAC,0BAA0B,CAAC,CAAA;QAChE,oBAAc,GAAG,OAAO,CAAC,cAAc,CAAC,CAAA;;KA6FjD;IA3FC,wCAAM,GAAN;QAAA,iBA0FC;QAzFK,IAAA,KAAqB,IAAI,EAAvB,KAAK,WAAA,EAAE,OAAO,aAAS,CAAA;QACvB,IAAA,OAAO,GAAc,OAAO,QAArB,EAAE,OAAO,GAAK,OAAO,QAAZ,CAAY;QAC5B,IAAA,WAAW,GAAK,KAAK,YAAV,CAAU;QAE3B,IAAI,UAAU,GAAG,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,KAAK,CAAC,CAAA;QACtD,IAAI,kBAAkB,GAAG,OAAO,CAAC,aAAa,IAAI,sBAAsB,CAAA;QACxE,IAAI,SAAS,GAAG,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,aAAa,EAAE,kBAAkB,CAAC,CAAA;QAC9E,IAAI,qBAAqB,GAAG,IAAI,CAAC,0BAA0B,CACzD,WAAW,EACX,OAAO,CAAC,oBAAoB,EAC5B,SAAS,EACT,OAAO,CAAC,mBAAmB,EAC3B,OAAO,CACR,CAAA;QAED,IAAI,SAAS,GAAG,IAAI,CAAC,cAAc,CACjC,WAAW,CAAC,WAAW,EACvB,WAAW,CAAC,WAAW,EACvB,OAAO,CAAC,iBAAiB,EACzB,OAAO,CAAC,YAAY,EACpB,OAAO,CACR,CAAA;QACK,IAAA,WAAW,GAAK,OAAO,YAAZ,CAAY;QAC7B,IAAI,eAAe,GAAG,CAAC,WAAW,CAAA;QAClC,IAAI,eAAe,GAAG,WAAW,CAAA;QAEjC,IAAI,aAAa,GAAG,OAAO,CAAC,UAAU,KACpC,cAAC,iBAAiB,IAChB,SAAS,EAAE,SAAS,EACpB,KAAK,EAAE,qBAAqB,CAAC,aAAa,CAAC,WAAW,EACtD,WAAW,EAAE,WAAW,EACxB,oBAAoB,QACpB,WAAW,EAAE,eAAe,GAAG,IAAI,CAAC,cAAc,GAAG,IAAI,GACzD,CACH,CAAA;QAED,IAAI,aAAa,GAAG,CAAC,OAAO,CAAC,UAAU,KAAK,KAAK,MAAM,UAAC,UAAoC,IAAK,QAC/F,cAAC,gBAAgB,eACX,UAAU,CAAC,MAAM,IACrB,WAAW,EAAE,WAAW,EACxB,qBAAqB,EAAE,qBAAqB,EAC5C,gBAAgB,EAAE,OAAO,CAAC,gBAAgB,EAC1C,aAAa,EAAE,UAAU,CAAC,aAAa,EACvC,YAAY,EAAE,UAAU,CAAC,iBAAiB,EAC1C,cAAc,EAAE,eAAe,GAAG,KAAI,CAAC,kBAAkB,GAAG,IAAI,EAChE,eAAe,EAAE,KAAK,EACtB,UAAU,EAAE,KAAK,EACjB,gBAAgB,EAAE,KAAI,CAAC,WAAW,EAClC,WAAW,EAAE,UAAU,CAAC,WAAW,EACnC,YAAY,EAAE,UAAU,CAAC,YAAY,EACrC,QAAQ,EAAE,KAAK,CAAC,QAAQ,IACpB,KAAI,CAAC,sBAAsB,EAAE,EACjC,IACH,CAAC,CAAA;QAEF,IAAI,eAAe,GAAG,UAAC,UAAoC,IAAK,QAC9D,cAAC,mBAAmB,eACd,UAAU,CAAC,KAAK,IACpB,WAAW,EAAE,WAAW,EACxB,IAAI,EAAE,eAAe,EACrB,YAAY,EAAE,OAAO,CAAC,YAAY,EAClC,SAAS,EAAE,SAAS,EACpB,qBAAqB,EAAE,qBAAqB,EAC5C,iBAAiB,EAAE,UAAU,CAAC,iBAAiB,EAC/C,aAAa,EAAE,UAAU,CAAC,aAAa,EACvC,WAAW,EAAE,UAAU,CAAC,WAAW,EACnC,YAAY,EAAE,UAAU,CAAC,YAAY,EACrC,YAAY,EAAE,KAAI,CAAC,gBAAgB,EACnC,UAAU,EAAE,UAAU,CAAC,UAAU,EACjC,QAAQ,EAAE,KAAK,CAAC,QAAQ,EACxB,kBAAkB,EAAE,KAAI,CAAC,sBAAsB,IAC/C,IACH,CAAA;QAED,OAAO,eAAe;cAClB,IAAI,CAAC,mBAAmB,CACxB,aAAa,EACb,aAAa,EACb,eAAe,EACf,qBAAqB,CAAC,MAAM,EAC5B,WAAW,EACX,SAAS,EACT,IAAI,CAAC,KAAK,CAAC,UAAU,CACtB;cACC,IAAI,CAAC,kBAAkB,CACvB,aAAa,EACb,aAAa,EACb,eAAe,CAChB,CAAA;KACJ;IACH,8BAAC;AAAD,CAlGA,CAA6C,YAAY,GAkGxD;AAED,SAAS,0BAA0B,CACjC,WAAwB,EACxB,oBAA0C,EAC1C,SAAqB,EACrB,mBAA4B,EAC5B,OAAwB;IAExB,IAAI,QAAQ,GAAG,kBAAkB,CAAC,WAAW,EAAE,oBAAoB,CAAC,CAAA;IAEpE,OAAO,mBAAmB;QACxB,IAAI,qBAAqB,CAAC,QAAQ,EAAE,SAAS,EAAE,OAAO,CAAC;QACvD,IAAI,qBAAqB,CAAC,QAAQ,EAAE,SAAS,EAAE,OAAO,CAAC,CAAA;AAC3D;;AC5GA,WAAe,YAAY,CAAC;IAC1B,IAAI,EAAE;QACJ,mBAAmB;QACnB,oBAAoB;QACpB,cAAc;KACf;IACD,WAAW,EAAE,qBAAqB;IAClC,KAAK,EAAE;QAEL,gBAAgB,EAAE;YAChB,IAAI,EAAE,UAAU;YAChB,SAAS,EAAE,uBAAuB;YAClC,iBAAiB,EAAE,IAAI;SACxB;QAED,mBAAmB,EAAE;YACnB,IAAI,EAAE,kBAAkB;YACxB,QAAQ,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE;SACtB;QAED,oBAAoB,EAAE;YACpB,IAAI,EAAE,kBAAkB;YACxB,QAAQ,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE;SACvB;KAEF;CACF,CAAC;;;;;"}